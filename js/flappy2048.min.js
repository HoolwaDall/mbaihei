function newCell() {
    var e = {};
    e.a = 1;
    e.dsa = 1;
    e.tn = null;
    e.birdlock = .15;
    e.x = 0;
    e.y = 0;
    e.vx = 0;
    e.vy = 0;
    e.dsz = 0;
    e.ang = e.dang = 0;
    e.clfr = 0;
    var t = document.createElement("div");
    e.div = t;
    t.style.left = e.x + "px";
    t.style.top = e.y + "px";
    t.style.width = cell_size + "px";
    t.style.height = cell_size + "px";
    t.style.lineHeight = cell_size + "px";
    t.style.position = "absolute";
    t.style.textAlign = "center";
    t.style.fontFamily = '"Clear Sans", "Helvetica Neue", Arial, sans-serif';
    t.style.fontSize = "70px";
    t.style.color = "#606060";
    t.style.fontWeight = "bold";
    t.style.marginTop = "auto";
    t.style.marginBottom = "auto";
    t.style.border = "12px solid #a0a0a0";
    t.style.borderRadius = "8px";
    t.style.zIndex = 311;
    t.className = "cellol";
    t.unselectable = "on";
    t.style.background = e.background = "#" + tile_colors[0];
    e.updatePos = function() {
        this.div.style.left = Math.round(this.x - 0 * this.dsz / 2) + "px";
        this.div.style.top = Math.round(this.y - 0 * this.dsz / 2) + "px"
    };
    e.value = 1;
    e.setValue = function(t) {
        this.value = t;
        var n = this.div;
        if (e.tn != null) {
            n.removeChild(e.tn);
            e.tn = null
        }
        if (t == 0) {
            n.innerHTML = "";
            n.style.background = this.background = "#a0a0a0";
            this.vs = " "
        } else {
            n.style.color = "#" + text_colors[Math.max(0, Math.min(text_colors.length - 1, this.value - 1))];
            var r = this.value - 1;
            var i;
            if (r < 0) r = 0;
            if (r >= tile_colors.length) {
                r -= tile_colors.length;
                r %= tile_colors_2.length;
                i = tile_colors_2[r]
            } else {
                i = tile_colors[r]
            }
            if (this == bird) {
                wing.ctx.globalCompositeOperation = "source-over";
                wing.ctx.clearRect(0, 0, 117, 131);
                wing.ctx2.fillStyle = "#" + i;
                wing.ctx2.fillRect(0, 0, 117, 131);
                wing.ctx.drawImage(wing.canvas2, 0, 0);
                wing.ctx.globalCompositeOperation = "destination-atop";
                wing.ctx.drawImage(wingfill.img, 0, 0);
                wing.ctx.globalCompositeOperation = "source-over";
                wing.ctx.drawImage(wing.img, 0, 0)
            }
            n.style.background = this.background = "#" + i;
            var s = getValueStr(this.value);
            this.vs = s;
            n.style.fontSize = Math.round(60 * Math.pow(9 / (9 + Math.min(7, s.length) - 1), 2.3)) + "px";
            e.tn = document.createTextNode("" + s);
            n.appendChild(e.tn)
        }
    };
    e.setValue(e.value);
    return e
}
var disable_mouse = false;
var cndSrc = "images/";
document.body.style.margin = "0px";
document.body.style.overflow = "hidden";
window.requestAnimationFrame = function() {
    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || window.setTimeout
}();
window.cancelAnimationFrame = function() {
    return window.cancelAnimationFrame || window.webkitCancelAnimationFrame || window.mozCancelAnimationFrame || window.oCancelAnimationFrame || window.msCancelAnimationFrame || window.clearTimeout
}();
var orient = false;
var raf = function(e) {
    alert("Sorry，本游戏暂不支持您的浏览器！")
};
if (window.requestAnimationFrame) raf = window.requestAnimationFrame;
else if (window.mozRequestAnimationFrame) raf = window.mozRequestAnimationFrame;
else if (window.webkitRequestAnimationFrame) raf = window.webkitRequestAnimationFrame;
var gameLocal = new LocalStorageManager;
if (gameLocal.getUserInfoKey() == "") {
    gameLocal.creatUserInfo(gameLocal.getUserOS(), gameLocal, function() {})
}
var game = {};
game.ended = false;
game.div = document.createElement("div");
game.div.style.cursor = "pointer";
game.div.style.overflow = "hidden";
game.div.style.position = "relative";
game.div.style.width = "100%";
game.div.style.height = "100%";
document.body.appendChild(game.div);
var deathflash = document.createElement("div");
deathflash.style.background = "#FF0000";
deathflash.style.zIndex = 9999;
deathflash.style.width = "100%";
deathflash.style.height = "100%";
deathflash.style.left = "0px";
deathflash.style.top = "0px";
deathflash.style.position = "absolute";
deathflash.style.display = "none";
deathflash.innerHTML = "&nbsp;";
game.div.appendChild(deathflash);
var cell_size = 88;
var resize = function() {
    ww = Math.ceil(window.innerWidth);
    hh = Math.ceil(window.innerHeight);
    game.div.style.width = ww + "px";
    game.div.style.height = hh + "px";
    game.bg.style.width = ww + "px";
    game.bg.style.height = hh + "px";
    ground.canvas.width = ww + 96;
    ground.canvas.height = 88;
    ground.ctx.fillStyle = "#bab8af";
    ground.ctx.fillRect(0, 0, ww + 96, 88);
    var e = 0;
    while (e < ww + 256) {
        try {
            ground.ctx.drawImage(ground.bit, e, 0)
        } catch (t) {}
        e += 48
    }
    ground.x = 0;
    ground.canvas.style.left = "0px";
    ground.canvas.style.top = hh - 88 + "px";
    logo.reposition();
    gameover.reposition();
    c2s.reposition();
    sndo.reposition();
    fbshare.reposition();
    playagain.reposition();
    parody.div.style.left = Math.round((ww - 800) / 2) + "px";
    parody.div.style.top = hh - 28 + "px";
    for (var n = 0; n < scpts.length; n++) {
        var r = scpts[n];
        xx = r.x;
        yy = r.y;
        var i = score.divs[n];
        i.style.left = Math.round(xx + (ww - 700) / 2) + "px";
        i.style.top = yy + 10 + "px"
    }
};
var want_image_count = 0;
var loadGameImage = function(e) {
    want_image_count++;
    var t = document.createElement("img");
    t.onload = function() {
        want_image_count--;
        if (want_image_count == 0 && want_sound_count == 0) {
            gameLoaded()
        }
    };
    t.src = e;
    return t
};
var want_sound_count = 0;
var loadGameSound = function(e, t) {
    var n = {};
    n.channels = [];
    n.channel_pos = 0;
    n.chc = t;
    n.play = function() {
        if (!sndo.has_sound) {
            return
        }
        var e = (new Date).getTime();
        var t = this.channels.length;
        var n = false;
        var r;
        for (var i = t; i >= 0; i--) {
            this.channel_pos++;
            if (this.channel_pos >= this.channels.length) {
                this.channel_pos = 0
            }
            var r = this.channels[this.channel_pos];
            n = true;
            break
        }
        if (n) {
            r.sound.play()
        }
    };
    for (var r = 0; r < t; r++) {
        var i = document.createElement("audio");
        var s = {};
        s.sound = i;
        s.can_play = true;
        n.channels.push(s);
        i.src = e;
        i.type = "audio/wav"
    }
    return n
};
var game_loaded = false;
var gameLoaded = function() {
    game.div.appendChild(game.bg);
    game.div.appendChild(ground.canvas);
    game.div.appendChild(logo.img);
    game.div.appendChild(gameover.img);
    document.body.appendChild(fbshare.img);
    document.body.appendChild(playagain.img);
    game.div.appendChild(c2s.img);
    game.div.appendChild(sndo.div);
    game.div.appendChild(parody.div);
    for (var e = score.divs.length - 1; e >= 0; e--) {
        game.div.appendChild(score.divs[e])
    }
    game.div.appendChild(bird.div);
    game_loaded = true;
    resize();
    raf(oef);
    oef();
    document.body.onmousedown = function() {
        if (!disable_mouse) {
            doFlap()
        }
    };
    document.body.addEventListener("touchstart", function(e) {
        disable_mouse = true;
        doFlap()
    }, false);
    document.body.onkeydown = function(e) {
        if (e.keyCode == 32) {
            doFlap()
        }
    };
    bird.setValue(1)
};
var last_flap_tm = 0;
var doFlap = function() {
    if (window.orientation && window.orientation != 0) {
        orient = true;
        alert("sorry！本游戏不支持横屏:(")
    } else {
        orient = false
    }
    if (game.ended) {
        return false
    }
    if (!game.started) {
        fr = 0;
        wgfr = 0;
        nbfr = fnbfr = 100;
        points = 0;
        score.update();
        for (var e = walls.length - 1; e >= 0; e--) {
            var t = walls[e];
            var n = t.cells;
            for (var r = n.length - 1; r >= 0; r--) {
                game.div.removeChild(n[r].div)
            }
        }
        walls = [];
        doubling = false;
        doubling_cell = null;
        bird.stuck_on_bottom = false;
        bird.stuck_on_top = false;
        bird.setValue(1);
        bird.dsz = 0;
        bird.ww = cell_size;
        bird.div.style.width = bird.ww + "px";
        game.cur_wall_val = 1;
        game.started = true;
        wall_fr_gap = wall_fr_start_gap;
        bird.reset();
        logo.showing = false;
        logo.hiding = true;
        gameover.showing = false;
        gameover.hiding = true;
        c2s.showing = false;
        c2s.hiding = true;
        fbshare.showing = false;
        fbshare.hiding = true;
        playagain.showing = false;
        playagain.hiding = true;
        parody.div.style.display = "none";
        points = 0;
        score.update()
    }
    var i = (new Date).getTime();
    var s = 1 - Math.min(1, Math.max(0, (i - last_flap_tm) / 666));
    last_flap_tm = i;
    bird.vy = -8 - 5 * s;
    bird.dang = -.5;
    wing.vfr = 2
};
var ww = 768;
var hh = 920;
game.bg = document.createElement("div");
game.bg.style.width = ww + "px";
game.bg.style.height = hh + "px";
game.bg.style.background = "#faf8ef";
game.started = false;
var wing = {};
wing.fr = 0;
wing.vfr = 0;
wing.img = loadGameImage(cndSrc + "wing.png");
wing.canvas = document.createElement("canvas");
wing.canvas.width = 150;
wing.canvas.height = 131;
wing.ctx = wing.canvas.getContext("2d");
wing.canvas2 = document.createElement("canvas");
wing.canvas2.width = 150;
wing.canvas2.height = 131;
wing.ctx2 = wing.canvas2.getContext("2d");
var wingfill = {};
wingfill.img = loadGameImage(cndSrc + "wingfill.png");
wingfill.canvas = document.createElement("canvas");
wingfill.canvas.width = 150;
wingfill.canvas.height = 131;
wingfill.ctx = wingfill.canvas.getContext("2d");
var logo = {};
logo.a = -.2;
logo.fr = 0;
logo.showing = true;
logo.hiding = false;
logo.img = loadGameImage(cndSrc + "logo.png");
logo.img.style.position = "absolute";
logo.img.style.opacity = 0;
logo.img.style.zIndex = "4200";
logo.reposition = function() {
    logo.img.style.left = Math.floor((ww - 626) / 2) + "px";
    logo.img.style.top = Math.floor(Math.cos(logo.fr / 9) * 20 + (hh - 188 - 88) / 2) + "px"
};
var gameover = {};
gameover.a = -.2;
gameover.fr = 0;
gameover.showing = false;
gameover.hiding = true;
gameover.img = loadGameImage(cndSrc + "gameover.png");
gameover.img.style.position = "absolute";
gameover.img.style.opacity = 0;
gameover.img.style.zIndex = "4200";
gameover.reposition = function() {
    gameover.img.style.left = Math.floor((ww - 626) / 2) + "px";
    gameover.img.style.top = Math.floor(Math.cos(gameover.fr / 32) * 0 + (hh - 200 - 144 - 88) / 2) + "px"
};
var fbshare = {};
fbshare.a = -.2;
fbshare.fr = 0;
fbshare.showing = false;
fbshare.hiding = true;
fbshare.img = loadGameImage(cndSrc + "fbshare.png");
fbshare.img.style.border = "0px";
fbshare.img.style.cursor = "pointer";
fbshare.img.border = 0;
fbshare.img.style.position = "absolute";
fbshare.img.style.display = "none";
fbshare.img.style.opacity = 0;
fbshare.img.style.zIndex = "1420";
fbshare.reposition = function() {
    fbshare.img.style.left = Math.floor((ww - 592) / 2) + "px";
    fbshare.img.style.top = Math.floor(Math.cos(fbshare.fr / 12) * 5 + (hh + 150 + 80 - 88) / 2) + "px"
};
fbshare.img.onclick = function() {

    window.location.href="objc://"+"rateGame:/0"; // by decamincow
    
};
var playagain = {};
playagain.a = -.2;
playagain.fr = 0;
playagain.showing = false;
playagain.hiding = true;
playagain.img = loadGameImage(cndSrc + "playagain.png");
playagain.img.style.border = "0px";
playagain.img.style.cursor = "pointer";
playagain.img.border = 0;
playagain.img.style.position = "absolute";
playagain.img.style.display = "none";
playagain.img.style.opacity = 0;
playagain.img.style.zIndex = "1419";
playagain.reposition = function() {
    playagain.img.style.left = Math.floor((ww - 252) / 2) + "px";
    playagain.img.style.top = Math.floor(Math.cos(playagain.fr / 14) * 5 + (hh + 320 + 71 - 88) / 2) + "px"
};
playagain.img.onclick = function() {
    game.ended = false;
    doFlap()
};
var playagain = {};
playagain.a = -.2;
playagain.fr = 0;
playagain.showing = false;
playagain.hiding = true;
playagain.img = loadGameImage(cndSrc + "playagain.png");
playagain.img.style.border = "0px";
playagain.img.style.cursor = "pointer";
playagain.img.border = 0;
playagain.img.style.position = "absolute";
playagain.img.style.display = "none";
playagain.img.style.opacity = 0;
playagain.img.style.zIndex = "1418";
playagain.reposition = function() {
    playagain.img.style.left = Math.floor((ww - 252) / 2) + "px";
    playagain.img.style.top = Math.floor(Math.cos(playagain.fr / 14) * 5 + (hh + 320 + 71 - 88) / 2) + "px"
};
playagain.img.onclick = function() {
    game.ended = false;
    doFlap()
};
var c2s = {};
c2s.a = -1;
c2s.showing = true;
c2s.hiding = false;
c2s.img = loadGameImage(cndSrc + "clicktostart.png");
c2s.img.style.position = "absolute";
c2s.img.style.opacity = 0;
c2s.img.style.zIndex = "42070";
c2s.reposition = function() {
    c2s.img.style.left = Math.floor((ww - 337) / 2) + "px";
    c2s.img.style.top = Math.floor((hh + 250) / 2) + "px"
};
var sndo = {};
sndo.showing = true;
sndo.hiding = false;
sndo.div = document.createElement("div");
//sndo.div.style.backgroundImage = 'url("images/soundoff.png")'; //decamincow
sndo.has_sound = true;
sndo.div.style.position = "absolute";
sndo.div.style.width = "64px";
sndo.div.style.height = "64px";
sndo.div.innerHTML = "&nbsp;";
sndo.div.style.zIndex = "1440";
sndo.reposition = function() {
    sndo.div.style.left = "6px";
    sndo.div.style.top = Math.floor(hh - 70) + "px"
};
sndo.div.onclick = function() {
    if (sndo.has_sound) {
        sndo.div.style.backgroundPosition = "-64px 0px";
        sndo.has_sound = false
    } else {
        sndo.div.style.backgroundPosition = "0px 0px";
        sndo.has_sound = true
    }
};
var parody = {};
parody.div = document.createElement("div");
parody.div.style.width = "800px";
parody.div.style.height = "24px";
parody.div.style.position = "absolute";
parody.div.style.textAlign = "center";
parody.div.style.fontFamily = "Verdana";
parody.div.style.fontSize = "12px";
parody.div.style.zIndex = 876;
parody.div.innerHTML = "";
var points = 0;
//var highscore = gameLocal.getBestScore() ? gameLocal.getBestScore() : 0;
var highscore = localStorage.flappy2048_hiScore; //decamincow
var rank = [0, 0];
var scpts = [];
var rad = 0;
for (var xx = -rad; xx <= rad; xx++) {
    for (var yy = -rad; yy <= rad; yy++) {
        var d = Math.sqrt(xx * xx + yy * yy);
        if (d <= rad) {
            var o = {};
            o.x = xx;
            o.y = yy;
            scpts.push(o)
        }
    }
}
var score = {};
score.divs = [];
for (var i = 0; i < scpts.length; i++) {
    var scpt = scpts[i];
    xx = scpt.x;
    yy = scpt.y;
    var div = document.createElement("div");
    score.divs.push(div);
    div.id = "score";
    div.style.width = "700px";
    div.style.height = "60px";
    div.style.position = "absolute";
    div.style.textAlign = "center";
    div.style.fontFamily = '"微软雅黑","Clear Sans", "Helvetica Neue", Arial, sans-serif';
    div.style.fontWeight = "bold";
    div.style.fontSize = "40px";
    div.style.color = "#faf8ef";
    div.style.zIndex = 888;
    div.style["user-select"] = "none";
    div.style["-webkit-user-select"] = "none";
    div.style["-moz-user-select"] = "none";
    div.style["-ms-user-select"] = "none";
    div.style["-o-user-select"] = "none";
    if (xx == 0 && yy == 0) {
        div.style.color = "#6c6c6c";
        div.style.zIndex = 888
    }
    div.innerHTML = ""
}
score.update = function() {
    for (var e = score.divs.length - 1; e >= 0; e--) {
        score.divs[e].style.top = 10;
        score.divs[e].style.fontSize = "40px";
        score.divs[e].innerHTML = points
    }
};
score.endUpdate = function() {
    for (var e = score.divs.length - 1; e >= 0; e--) {
        // decamincow
        if(points > localStorage.flappy2048_hiScore){
            localStorage.flappy2048_hiScore = points;
        }
        score.divs[e].style.fontSize = "30px";
        score.divs[e].style.top = Number(Number(gameover.img.style.top.split("px")[0]) + 150) + "px";
        score.divs[e].innerHTML = "得分：" + points + " | 最高：<span style='color:#F00;'>" + localStorage.flappy2048_hiScore + "</span>";
        var t = new Object;
//        if (highscore == 0) {
//            highscore = 1
//        }
        t["gameid"] = 2;
        t["key"] = gameLocal.getUserInfoKey();
        t["score"] = highscore;
        updateShareScore(getValueStr(bird.value), points)
    }
};
var ground = {};
ground.canvas = document.createElement("canvas");
ground.canvas.style.position = "absolute";
ground.canvas.style.zIndex = "313";
ground.ctx = ground.canvas.getContext("2d");
ground.bit = loadGameImage(cndSrc + "ground.png");
var vstrs = ["1"];
var getValueStr = function(e) {
    while (vstrs.length <= e) {
        var t = vstrs[vstrs.length - 1];
        var n = 0;
        var r = 0;
        var i = "";
        for (var s = t.length - 1; s >= 0; s--) {
            n = Number("" + t.charAt(s));
            n *= 2;
            n += r;
            r = Math.floor(n / 10);
            n -= r * 10;
            i = n + "" + i
        }
        if (r > 0) {
            i = r + "" + i
        }
        vstrs.push(i)
    }
    return vstrs[e - 1]
};
var text_colors = ["606060", "606060", "606060", "ffffff"];
var tile_colors = ["eeeeee", "eae8e4", "ede0c8", "f2b179", "f59563", "f67c5f", "f65e3b", "edcf72", "edcc61", "edc850", "edc53f", "edc53f", "3c3a32"];
var tile_colors_2 = ["4c4c4c", "5c5c5c", "4c5c6c", "4c4c7c", "3c3c6c", "2c2c5c", "2c3c4c", "2c4c3c", "2c5c2c", "3c3a32"];
var wall_fr_start_gap = 150;
var wall_fr_gap = wall_fr_start_gap;
var vxr = 1;
var bird = newCell();
bird.wingdiv = document.createElement("div");
bird.wingdiv.style.position = "absolute";
bird.wingdiv.style.left = "-70px";
bird.wingdiv.style.top = "-30px";
bird.wingdiv.style.width = "150px";
bird.wingdiv.style.height = "131px";
bird.div.appendChild(bird.wingdiv);
bird.reset = function() {
    this.x = 150;
    this.y = 150;
    this.vvy = 0
};
bird.reset();
bird.div.style.zIndex = 666;
bird.wingdiv.appendChild(wing.canvas);
bird.updatePos();
var wall_cell_count = 24;
var walls = [];
var newWall = function(e) {
    var t = {};
    t.clc = null;
    t.cells = [];
    t.x = ww + 32;
    t.vx = -5 * vxr;
    t.value = e;
    var n = 0;
    var r = t.cells;
    for (var i = 0; i < wall_cell_count; i++) {
        var s = newCell();
        s.x = t.x;
        s.sty = (i + 1) * (cell_size + 14);
        s.y = hh - 88 - s.sty;
        s.sy = s.y;
        s.vx = t.vx;
        game.div.appendChild(s.div);
        r.push(s);
        s.setValue(e);
        n = Math.max(n, s.vs.length);
        if (s.y <= 0 && r.length >= 4) {
            break
        }
    }
    t.ww = cell_size + Math.max(0, 22 * (n - 6));
    var o = e;
    var u = [];
    var a;
    a = e - Math.round(r.length / 2);
    if (a <= 1) a = 1;
    for (var i = r.length - 1; i >= 1; i--) {
        a++;
        if (a == e) a += 2;
        u.push(a)
    }
    var f = Math.floor(Math.random() * u.length);
    a = u[f];
    u.splice(f, 1);
    r[r.length - 1].setValue(a);
    var f = Math.floor(Math.random() * u.length);
    a = u[f];
    u.splice(f, 1);
    r[0].setValue(a);
    u.push(o);
    for (var i = r.length - 2; i >= 1; i--) {
        var f = Math.floor(Math.random() * u.length);
        a = u[f];
        u.splice(f, 1);
        r[i].setValue(a)
    }
    var l = r.length;
    for (var i = r.length - 1; i >= 0; i--) {
        var s = r[i];
        var c = newCell();
        c.x = t.x;
        c.sty = s.sty + l * (cell_size + 14);
        c.y = hh - 88 - c.sty;
        c.sy = c.y;
        c.vx = t.vx;
        game.div.appendChild(c.div);
        r.push(c);
        c.setValue(s.value)
    }
    for (var i = r.length - 1; i >= 0; i--) {
        var s = r[i];
        s.ww = t.ww;
        s.div.style.width = s.ww + "px"
    }
    t.kill = function() {
        for (var e = this.cells.length - 1; e >= 0; e--) {
            var t = this.cells[e];
            game.div.removeChild(t.div)
        }
        for (var n = walls.length - 1; n >= 0; n--) {
            if (walls[n] == this) {
                walls.splice(n, 1)
            }
        }
    };
    t.vspeed = (e / 11 - 1) * .66;
    if (t.vspeed > 1.5) t.vspeed = 1.5;
    if (t.vspeed < 0) t.vspeed = 0;
    t.dir = e % 2 == 0 ? 1 : -1;
    walls.push(t);
    return t
};
var doubling = false;
var doubling_cell = null;
var fr = 0;
var wgfr = 0;
var ltm = 0;
var oef = function() {
    if (game_loaded && !orient) {
        var e = (new Date).getTime();
        var t;
        var n = 0;
        while (ltm < e) {
            ltm += 20;
            n++;
            if (n > 10) {
                ltm = e;
                break
            }
            if (game.started) {
                fr++;
                wgfr++;
                ground.x -= 5 * vxr;
                ground.x %= 48;
                if (ground.x > 0) ground.x -= 48;
                ground.canvas.style.left = ground.x + "px";
                wing.fr += .25;
                wing.fr += wing.vfr;
                wing.vfr *= .9;
                var r = Math.cos(wing.fr / 2) * 23 + 15;
                r = Math.round(r * 100) / 100;
                var i = 1;
                var s = wing.canvas;
                s.style.webkitTransform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                s.style.mozTransform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                s.style.msTransform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                s.style.oTransform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                s.style.transform = "rotate(" + r + "deg) scale(" + i + "," + i + ")"
            }
            if (logo.showing) {
                logo.a += .03;
                if (logo.a >= 1) {
                    logo.a = 1;
                    logo.showing = false
                }
                logo.img.style.opacity = logo.a
            }
            if (logo.hiding) {
                logo.a -= .05;
                if (logo.a <= 0) {
                    logo.a = 0;
                    logo.hiding = false
                }
                logo.img.style.opacity = logo.a
            }
            if (logo.a > 0) {
                logo.fr++;
                logo.reposition()
            }
            if (logo.a > .01) {
                if (!logo.visible) {
                    logo.visible = true;
                    logo.img.style.display = "inline"
                }
            } else {
                if (logo.visible) {
                    logo.visible = false;
                    logo.img.style.display = "none"
                }
            }
            if (gameover.showing) {
                gameover.a += .03;
                if (gameover.a >= 1) {
                    window.location.href="objc://"+"gameOver:/0"; //by decamincow
                    gameover.a = 1;
                    gameover.showing = false
                }
                gameover.img.style.opacity = gameover.a
            }
            if (gameover.hiding) {
                gameover.a -= .1;
                if (gameover.a <= 0) {
                    gameover.a = 0;
                    gameover.hiding = false
                }
                gameover.img.style.opacity = gameover.a
            }
            if (gameover.a > 0) {
                gameover.fr++;
                gameover.reposition()
            }
            if (gameover.a > .01) {
                if (!gameover.visible) {
                    gameover.visible = true;
                    gameover.img.style.display = "inline"
                }
            } else {
                if (gameover.visible) {
                    gameover.visible = false;
                    gameover.img.style.display = "none"
                }
            }
            if (fbshare.showing) {
                fbshare.a += .03;
                if (fbshare.a >= 1) {
                    fbshare.a = 1;
                    fbshare.showing = false
                }
                fbshare.img.style.opacity = fbshare.a
            }
            if (fbshare.hiding) {
                fbshare.a -= .1;
                if (fbshare.a <= 0) {
                    fbshare.a = 0;
                    fbshare.hiding = false
                }
                fbshare.img.style.opacity = fbshare.a
            }
            if (fbshare.a > 0) {
                fbshare.fr++;
                fbshare.reposition()
            }
            if (fbshare.a > .01) {
                if (!fbshare.visible) {
                    fbshare.visible = true;
                    fbshare.img.style.display = "inline"
                }
            } else {
                if (fbshare.visible) {
                    fbshare.visible = false;
                    fbshare.img.style.display = "none"
                }
            }
            if (playagain.showing) {
                playagain.a += .03;
                if (playagain.a >= 1) {
                    playagain.a = 1;
                    playagain.showing = false
                }
                playagain.img.style.opacity = playagain.a
            }
            if (playagain.hiding) {
                playagain.a -= .1;
                if (playagain.a <= 0) {
                    playagain.a = 0;
                    playagain.hiding = false
                }
                playagain.img.style.opacity = playagain.a
            }
            if (playagain.a > 0) {
                playagain.fr++;
                playagain.reposition()
            }
            if (playagain.a > .01) {
                if (!playagain.visible) {
                    playagain.visible = true;
                    playagain.img.style.display = "inline"
                }
            } else {
                if (playagain.visible) {
                    playagain.visible = false;
                    playagain.img.style.display = "none"
                }
            }
            if (c2s.showing) {
                c2s.a += .03;
                if (c2s.a >= 1) {
                    c2s.a = 1;
                    c2s.showing = false
                }
                c2s.img.style.opacity = c2s.a
            }
            if (c2s.hiding) {
                c2s.a -= .1;
                if (c2s.a <= 0) {
                    c2s.a = 0;
                    c2s.hiding = false
                }
                c2s.img.style.opacity = c2s.a
            }
            if (c2s.a > .01) {
                if (!c2s.visible) {
                    c2s.visible = true;
                    c2s.img.style.display = "inline"
                }
            } else {
                if (c2s.visible) {
                    c2s.visible = false;
                    c2s.img.style.display = "none"
                }
            }
            if (game.started) {
                wgfr %= wall_fr_gap;
                if (wgfr == 10) {
                    var o = newWall(game.cur_wall_val);
                    wall_fr_gap = Math.max(wall_fr_gap, wall_fr_start_gap + Math.floor(.5 * Math.ceil(o.ww - cell_size)));
                    game.cur_wall_val++
                }
                for (var u = walls.length - 1; u >= 0; u--) {
                    var o = walls[u];
                    var a = o.cells.length * (cell_size + 14);
                    var f = o.cells;
                    o.x += o.vx;
                    for (var l = f.length - 1; l >= 0; l--) {
                        var c = f[l];
                        c.vx = o.vx;
                        c.x = o.x;
                        c.y = hh - 88 - (c.sty + a * 30 + o.vspeed * o.dir * (o.x - (o.ww + 12 * 2) - bird.x)) % a;
                        c.updatePos()
                    }
                    if (o.x < -o.ww - 140) {
                        o.kill()
                    }
                }
                bird.x += (150 - bird.x) * .9;
                bird.y += Math.max(-8, Math.min(13, bird.vy));
                bird.ang += (bird.dang - bird.ang) * .3;
                var h = false;
                var p = false;
                for (var u = walls.length - 1; u >= 0; u--) {
                    var o = walls[u];
                    var d = bird.x;
                    if (!o.passed) {
                        var v = o.value;
                        var m = o.ww + 12 * 2;
                        var g = null;
                        var y = false;
                        var f = o.cells;
                        var b = 1;
                        var w = 1;
                        if (!y) {
                            if (o.clc != null) {
                                g = o.clc;
                                y = true;
                                h = true
                            } else {
                                if (d > o.x - m) {
                                    if (d < o.x + m) {
                                        var E = 999999;
                                        for (var l = f.length - 1; l >= 0; l--) {
                                            var c = f[l];
                                            var S = Math.abs(c.y - bird.y);
                                            if (S < E) {
                                                E = S;
                                                g = c;
                                                o.clc = g;
                                                h = true;
                                                y = true
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        if (g == null) {
                            if (o.value <= 3) {
                                for (var l = 0; l < f.length; l++) {
                                    var c = f[l];
                                    if (c.value == v) {
                                        g = f[l];
                                        y = false;
                                        w = .4;
                                        b = .4;
                                        break
                                    }
                                }
                            }
                        }
                        if (g != null) {
                            var x = g.background.split("#").join("");
                            var T = parseInt(x.substr(0, 2), 16);
                            var N = parseInt(x.substr(2, 2), 16);
                            var C = parseInt(x.substr(4, 2), 16);
                            g.clfr += b;
                            var k = Math.sin(g.clfr / 2) * 32 * w;
                            T += k;
                            N += k;
                            C += k;
                            T = Math.max(0, Math.min(255, Math.round(T)));
                            N = Math.max(0, Math.min(255, Math.round(N)));
                            C = Math.max(0, Math.min(255, Math.round(C)));
                            var L;
                            T = "00" + T.toString(16);
                            N = "00" + N.toString(16);
                            C = "00" + C.toString(16);
                            x = "#" + T.substr(T.length - 2) + N.substr(N.length - 2) + C.substr(C.length - 2);
                            g.div.style.background = x;
                            if (y) {
                                g.div.style.opacity = Math.floor(g.a * 100) / 100;
                                bird.y += (g.y - bird.y) * g.birdlock;
                                g.birdlock += .1;
                                if (g.birdlock >= 1) {
                                    g.birdlock = 1
                                }
                                bird.vy *= .7;
                                bird.dang *= .8;
                                if (bird.y > hh - 166) {
                                    bird.vy = -13
                                }
                                if (bird.stuck_on_bottom || bird.y >= hh - 89 - (cell_size + 12 * 2)) {
                                    bird.stuck_on_bottom = true;
                                    bird.y = hh - 89 - (cell_size + 12 * 2);
                                    bird.vy = -14
                                }
                                if (bird.stuck_on_top || bird.y < -(cell_size + 12 * 2)) {
                                    bird.stuck_on_top = true;
                                    bird.y = -(cell_size + 12 * 2);
                                    bird.vy = 0
                                }
                                p = true;
                                if (g.value != v) {
                                    bird.vy = -10;
                                    game.ended = true
                                } else if (bird.x > g.x + 16) {
                                    o.passed = true;
                                    if (!doubling) {
                                        bird.setValue(bird.value + 1);
                                        bird.stuck_on_bottom = false;
                                        bird.stuck_on_top = false;
                                        bird.ww = g.ww;
                                        bird.div.style.width = g.ww + "px";
                                        doubling = true;
                                        doubling_cell = g;
                                        points += 1 + parseInt(points / 3);
                                        score.update()
                                    }
                                }
                            }
                        }
                    }
                }
                if (doubling) {
                    bird.vvy = 0;
                    var A = 0;
                    doubling_cell.a -= .15;
                    if (doubling_cell.a <= 0) {
                        doubling_cell.a = 0;
                        A++
                    }
                    doubling_cell.dsa -= .15;
                    if (doubling_cell.dsa <= 0) {
                        doubling_cell.dsa = 0;
                        A++
                    }
                    var O = .5 * Math.sin(Math.PI * doubling_cell.dsa);
                    bird.dsz = O;
                    doubling_cell.div.style.opacity = Math.floor(doubling_cell.a * 100) / 100;
                    if (A == 2) {
                        A = 0;
                        doubling = false
                    }
                }
                if (!p && !doubling) {
                    bird.vvy += .1;
                    if (bird.vvy > 1) bird.vvy = 1;
                    bird.vy += .65 * bird.vvy;
                    if (bird.vy >= 13) bird.vy = 13;
                    bird.dang += .025;
                    if (bird.dang > .5) bird.dang = .5
                }
                bird.updatePos();
                var s = bird.div;
                var r = bird.ang * (cell_size / Math.max(cell_size, cell_size + (bird.ww - cell_size) * 2)) * 180 / Math.PI;
                r = Math.round(r * 100) / 100;
                var i = 1 + bird.dsz;
                s.style.webkitTransform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                s.style.mozTransform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                s.style.msTransform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                s.style.oTransform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                s.style.transform = "rotate(" + r + "deg) scale(" + i + "," + i + ")";
                var M = hh - 88 - (cell_size + 12 * 2);
                if (bird.y > M) {
                    if (!h) {
                        bird.vy = -10;
                        game.ended = true
                    }
                }
                if (game.ended) {
                    game.end_fr = 0;
                    deathflash.style.display = "inline";
                    deathflash.style.opacity = .8;
                    game.started = false;
                    game.ended = true;
                    gameover.hiding = false;
                    gameover.showing = true;
                    fbshare.hiding = false;
                    fbshare.showing = true;
                    playagain.hiding = false;
                    playagain.showing = true;
                    score.endUpdate()
                }
            }
        }
    }
    if (game.ended) {
        game.end_fr++;
        var _ = .8 * (1 - game.end_fr / 20);
        if (_ < 0) {
            deathflash.style.display = "none"
        } else {
            deathflash.style.opacity = _
        }
        var s = bird.div;
        s.style.webkitTransform = "rotate(0deg) scale(1,1)";
        s.style.mozTransform = "rotate(0deg) scale(1,1)";
        s.style.msTransform = "rotate(0deg) scale(1,1)";
        s.style.oTransform = "rotate(0deg) scale(1,1)";
        s.style.transform = "rotate(0deg) scale(1,1)";
        bird.vy += .55;
        bird.y += bird.vy;
        var M = hh - 88 - (cell_size + 12 * 2);
        if (bird.y > M) {
            bird.y = M
        }
        bird.updatePos()
    }
    raf(oef)
};
window.onresize = function() {
    resize()
}